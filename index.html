<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>For Ayl üå∏</title>
  <style>
    :root{
      --bg1:#fff3f6;
      --bg2:#fffdf7;
      --ink:#2b1b1f;
      --muted:#6b4b55;
      --accent:#ff4d7d;
      --accent2:#ffb703;
      --card:#ffffffcc;
      --shadow: 0 18px 50px rgba(0,0,0,.12);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--ink);
      min-height:100vh;
      background:
        radial-gradient(1200px 700px at 20% 10%, var(--bg2), transparent 60%),
        radial-gradient(1000px 800px at 80% 30%, #ffe3ea, transparent 60%),
        linear-gradient(135deg, var(--bg1), #fff);
      overflow:hidden;
    }

    .wrap{
      position:relative;
      height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px;
    }

    .card{
      width:min(980px, 100%);
      background: var(--card);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,.8);
      border-radius: 22px;
      box-shadow: var(--shadow);
      overflow:hidden;
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      min-height: 620px;
    }

    @media (max-width: 860px){
      body{overflow:auto}
      .wrap{height:auto; min-height:100vh; padding:14px}
      .card{grid-template-columns: 1fr; min-height:auto}
    }

    .left{
      padding:26px 26px 20px;
      position:relative;
    }
    .right{
      padding:26px;
      background: linear-gradient(180deg, rgba(255,255,255,.25), rgba(255,255,255,.05));
      border-left: 1px solid rgba(255,255,255,.65);
      position:relative;
      overflow:hidden;
    }
    @media (max-width: 860px){
      .right{border-left:none; border-top: 1px solid rgba(255,255,255,.65)}
    }

    h1{
      margin:0 0 10px;
      font-size: clamp(26px, 3.4vw, 40px);
      letter-spacing:-0.02em;
      line-height:1.05;
    }
    p{
      margin:8px 0;
      color:var(--muted);
      line-height:1.5;
      font-size: 15.5px;
    }

    .btnrow{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top:16px;
    }
    button, .linkbtn{
      appearance:none;
      border:none;
      cursor:pointer;
      border-radius:14px;
      padding:12px 14px;
      font-weight:650;
      font-size:14px;
      letter-spacing: .01em;
      transition: transform .12s ease, filter .12s ease, background .12s ease;
      user-select:none;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
    }
    button:active, .linkbtn:active{transform: translateY(1px) scale(.99)}
    button:disabled{
      opacity:.5;
      cursor:not-allowed;
      filter: grayscale(.1);
    }
    .primary{
      background: linear-gradient(135deg, var(--accent), #ff7aa0);
      color:white;
      box-shadow: 0 10px 24px rgba(255, 77, 125, .25);
    }
    .ghost{
      background:#ffffffb8;
      border:1px solid rgba(0,0,0,.08);
      color:#4e2f38;
    }
    .warn{
      background: linear-gradient(135deg, var(--accent2), #ffd166);
      color:#3a2a00;
      box-shadow: 0 10px 24px rgba(255, 183, 3, .25);
    }
    .small{
      padding:10px 12px;
      border-radius:12px;
      font-size:13px;
      font-weight:650;
    }

    .stage{
      position:relative;
      border-radius:18px;
      border:1px dashed rgba(0,0,0,.14);
      background: radial-gradient(700px 420px at 40% 25%, rgba(255,255,255,.65), rgba(255,255,255,.1));
      height: 360px;
      overflow:hidden;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.5);
    }
    @media (max-width: 860px){
      .stage{height: 380px}
    }

    .hud{
      position:absolute;
      inset:14px 14px auto 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      z-index:6;
    }
    .counter{
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border-radius:999px;
      background:#ffffffc8;
      border:1px solid rgba(0,0,0,.08);
      font-size:13px;
      color:#4e2f38;
    }
    .bar{
      width:170px;
      height:10px;
      border-radius:999px;
      background: rgba(0,0,0,.08);
      overflow:hidden;
    }
    .bar > i{
      display:block;
      height:100%;
      width:0%;
      border-radius:999px;
      background: linear-gradient(90deg, var(--accent), #ff9bb5);
      transition: width .2s ease;
    }

    .howto{
      margin-top:12px;
      background:#ffffffc8;
      border:1px solid rgba(0,0,0,.08);
      border-radius:16px;
      padding:12px 12px;
      color:#4e2f38;
      font-size:13px;
      line-height:1.4;
    }

    /* petals */
    .petal{
      position:absolute;
      width:28px;
      height:28px;
      border-radius: 40% 60% 55% 45% / 55% 45% 55% 45%;
      background:
        radial-gradient(circle at 30% 30%, #fff, rgba(255,255,255,.2) 35%),
        linear-gradient(135deg, #ff5c8a, #ffb3c6);
      box-shadow: 0 10px 18px rgba(255, 92, 138, .25);
      transform: rotate(var(--r,0deg));
      opacity:.95;
      animation: floatDown var(--t,7.5s) linear forwards;
      cursor:pointer;
      touch-action: manipulation;
      z-index:5;
    }
    .petal::after{
      content:"";
      position:absolute;
      inset:7px 10px 8px 10px;
      border-radius:999px;
      background: rgba(255,255,255,.35);
      transform: rotate(18deg);
    }
    @keyframes floatDown{
      0%{ transform: translate(var(--x0,0px), -40px) rotate(var(--r,0deg)); }
      100%{ transform: translate(var(--x1, 60px), var(--yEnd, 520px)) rotate(calc(var(--r,0deg) + 220deg)); }
    }

    /* bouquet */
    .bouquet{
      position:absolute;
      inset:0;
      display:grid;
      place-items:center;
      pointer-events:none;
      opacity:.9;
      z-index:1;
    }
    .flowerSvg{
      width:min(320px, 70%);
      filter: drop-shadow(0 18px 24px rgba(0,0,0,.12));
      animation: breathe 2.8s ease-in-out infinite;
    }
    @keyframes breathe{
      0%,100%{transform: translateY(0px) scale(1)}
      50%{transform: translateY(-4px) scale(1.01)}
    }

    /* pandas roam until win/reset */
    .pandas{
      position:absolute;
      left:0; right:0; bottom:2px;
      height:96px;
      z-index:4;
      pointer-events:none;
    }
    .panda{
      position:absolute;
      bottom:0;
      width:92px;
      height:92px;
      border-radius:20px;
      overflow:hidden;
      filter: drop-shadow(0 12px 20px rgba(0,0,0,.16));
      transform-origin: bottom;
      background:#fff;
      border:1px solid rgba(0,0,0,.07);
      animation: pandaBob 2.4s ease-in-out infinite;
    }
    .panda img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
      transform: scaleX(var(--flip, 1));
    }
    .panda.roamL{
      left: 6px;
      animation:
        pandaBob 2.4s ease-in-out infinite,
        pandaRoamL 16s ease-in-out infinite;
    }
    .panda.roamR{
      right: 6px;
      animation:
        pandaBob 2.4s ease-in-out infinite,
        pandaRoamR 18s ease-in-out infinite;
    }
    .panda.chomp{
      animation:
        pandaChomp .25s ease-in-out 1,
        pandaBob 2.4s ease-in-out infinite;
    }
    @keyframes pandaBob{
      0%,100%{ transform: translateY(0); }
      50%{ transform: translateY(-4px); }
    }
    @keyframes pandaRoamL{
      0%,100%{ transform: translateX(0); }
      50%{ transform: translateX(140px); }
    }
    @keyframes pandaRoamR{
      0%,100%{ transform: translateX(0); }
      50%{ transform: translateX(-160px); }
    }
    @keyframes pandaChomp{
      0%{ transform: translateY(0) scale(1); }
      50%{ transform: translateY(-2px) scale(1.04); }
      100%{ transform: translateY(0) scale(1); }
    }

    /* Win overlay */
    .winOverlay{
      position:absolute;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      z-index:10;
      background: rgba(255,255,255,.78);
      backdrop-filter: blur(2px);
    }
    .winOverlay.show{display:flex;}
    .winBadge{
      background:#ffffffd8;
      border:1px solid rgba(0,0,0,.10);
      border-radius:18px;
      padding:18px 20px;
      box-shadow: 0 18px 40px rgba(0,0,0,.12);
      text-align:center;
      color:#4e2f38;
      min-width: 220px;
    }
    .winBadge b{
      display:block;
      font-size:22px;
      margin-bottom:6px;
      letter-spacing:-0.01em;
    }
    .winBadge span{
      font-size:13px;
      color:#6b4b55;
    }

    /* right panel */
    .panelTitle{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:10px;
    }
    .panelTitle h2{
      margin:0;
      font-size:18px;
      letter-spacing:-0.01em;
    }

    /* envelope */
    .envelopeWrap{
      margin-top:12px;
      display:grid;
      place-items:center;
      height: 360px;
    }
    .envelope{
      width:min(360px, 100%);
      height:240px;
      position:relative;
      border-radius:18px;
      background: linear-gradient(135deg, rgba(255,77,125,.12), rgba(255,183,3,.10));
      border:1px solid rgba(0,0,0,.08);
      box-shadow: 0 16px 40px rgba(0,0,0,.10);
      overflow:hidden;
      transform: translateY(6px);
    }
    .env-body{
      position:absolute;
      inset:0;
      background: rgba(255,255,255,.55);
    }
    .env-letter{
      position:absolute;
      left:16px; right:16px; bottom:-150px;
      height:200px;
      border-radius:14px;
      background:#fff;
      border:1px solid rgba(0,0,0,.08);
      box-shadow: 0 18px 30px rgba(0,0,0,.12);
      transition: transform .7s ease, bottom .7s ease;
      padding:14px 14px;
      color:#4e2f38;
      font-size:13px;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
    }
    .env-flap{
      position:absolute;
      left:-10%;
      right:-10%;
      top:-10%;
      height:60%;
      background: linear-gradient(135deg, rgba(255,77,125,.25), rgba(255,183,3,.18));
      clip-path: polygon(0 0, 100% 0, 50% 68%);
      transform-origin: top;
      transform: rotateX(0deg);
      transition: transform .7s ease;
      border-bottom: 1px solid rgba(0,0,0,.06);
    }
    .env-front{
      position:absolute;
      inset:auto 0 0 0;
      height:70%;
      background: rgba(255,255,255,.40);
      clip-path: polygon(0 100%, 0 0, 50% 55%, 100% 0, 100% 100%);
      border-top: 1px solid rgba(0,0,0,.06);
    }
    .env-note{
      position:absolute;
      left:14px; right:14px;
      bottom:14px;
      font-size:13px;
      color:#6b4b55;
      background:#ffffffc8;
      border:1px solid rgba(0,0,0,.06);
      padding:10px 12px;
      border-radius:14px;
      text-align:center;
    }

    /* unlock button (center) */
    .unlockBtn{
      position:absolute;
      left:50%;
      top:50%;
      transform: translate(-50%, -50%);
      z-index:5;
      display:none;
      padding:12px 14px;
      border-radius:999px;
      background: linear-gradient(135deg, var(--accent), #ff7aa0);
      color:#fff;
      font-weight:750;
      border: none;
      box-shadow: 0 14px 28px rgba(255, 77, 125, .25);
      cursor:pointer;
    }
    .unlockBtn:active{ transform: translate(-50%, -50%) scale(.99); }
    .unlockBtn.show{ display:inline-flex; }

    .envelope.open .env-flap{ transform: rotateX(180deg); }
    .envelope.open .env-letter{ bottom:18px; transform: translateY(-14px); }

    /* invite reveal (hidden until envelope unlocked) */
    .inviteBox{
      margin-top:14px;
      padding:14px;
      border-radius:18px;
      background:#ffffffc6;
      border:1px solid rgba(0,0,0,.08);
    }
    .inviteLine{
      display:flex;
      gap:10px;
      align-items:flex-start;
      margin:10px 0;
      color:#4e2f38;
      font-size:14px;
      line-height:1.35;
    }
    .dot{
      width:10px;height:10px;border-radius:50%;
      background: linear-gradient(135deg, var(--accent), #ff98b1);
      margin-top:5px;
      flex:0 0 auto;
      box-shadow: 0 8px 14px rgba(255,77,125,.25);
    }

    /* photos only after envelope unlocked */
    .photos{
      margin-top:14px;
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:12px;
    }
    .ph{
      aspect-ratio: 9 / 16;
      border-radius:18px;
      border:1px solid rgba(0,0,0,.06);
      overflow:hidden;
      background: rgba(255,255,255,.35);
    }
    .ph img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }
    @media (max-width: 860px){
      .photos{ grid-template-columns: 1fr 1fr; }
      .ph:nth-child(3){ grid-column: 1 / -1; }
      .ph{ aspect-ratio: 3 / 4; }
    }

    /* copied preview */
    .copiedPreview{ margin-top:12px; }
    .copiedLabel{ font-size:12px; color:#6b4b55; margin-bottom:6px; }
    .copiedBox{
      background:#ffffffc8;
      border:1px solid rgba(0,0,0,.08);
      border-radius:14px;
      padding:10px 12px;
      font-size:13px;
      color:#4e2f38;
      white-space:pre-wrap;
    }

    /* toast */
    .toast{
      position:fixed;
      left:50%;
      transform: translateX(-50%);
      bottom:18px;
      background:#111;
      color:#fff;
      padding:10px 12px;
      border-radius:999px;
      font-size:13px;
      opacity:0;
      pointer-events:none;
      transition: opacity .2s ease, transform .2s ease;
      z-index:9999;
    }
    .toast.show{
      opacity:.92;
      transform: translateX(-50%) translateY(-4px);
    }

    /* confetti */
    .confetti{
      position:fixed;
      inset:-20px 0 0 0;
      pointer-events:none;
      z-index:9998;
      overflow:hidden;
      display:none;
    }
    .confetti.show{display:block;}
    .confetti i{
      position:absolute;
      width:10px;height:16px;
      background: linear-gradient(180deg, var(--accent), #ffd166);
      opacity:.9;
      border-radius:3px;
      animation: confettiFall var(--ct,1.8s) linear forwards;
      transform: rotate(var(--cr,0deg));
    }
    @keyframes confettiFall{
      from{ transform: translateY(-30px) rotate(var(--cr,0deg)); }
      to{ transform: translateY(calc(100vh + 60px)) rotate(calc(var(--cr,0deg) + 520deg)); }
    }

    .footerNote{
      margin-top:14px;
      font-size:12.5px;
      color:#6b4b55;
      opacity:.9;
    }

    /* freeze everything on win */
    .stage.frozen *{
      animation-play-state: paused !important;
    }
    .stage.frozen .petal{
      pointer-events:none;
    }
  </style>
</head>
<body>
  <div class="confetti" id="confetti"></div>
  <div class="toast" id="toast">Copied ‚úÖ</div>

  <div class="wrap">
    <div class="card">
      <section class="left">
        <h1>Hi <span id="name">Ayl</span> üå∏</h1>
        <p>
          I brought you flowers‚Ä¶ but I may have ‚Äúaccidentally‚Äù dropped the petals everywhere.
          <br/>Collect <b id="goalInline">14</b> petals to open something.
        </p>

        <div class="stage" id="stage" aria-label="Petal mini-game area">
          <div class="hud">
            <div class="counter">
              <span>Petals:</span>
              <b id="count">0</b>/<span id="goal">14</span>
              <span class="bar" aria-hidden="true"><i id="barFill"></i></span>
            </div>
            <button class="ghost small" id="spawnBurst" title="More petals">More petals</button>
          </div>

          <div class="bouquet" aria-hidden="true">
            <svg class="flowerSvg" viewBox="0 0 260 260">
              <defs>
                <radialGradient id="p" cx="30%" cy="30%">
                  <stop offset="0%" stop-color="#fff"/>
                  <stop offset="45%" stop-color="#ffd1dc"/>
                  <stop offset="100%" stop-color="#ff4d7d"/>
                </radialGradient>
                <linearGradient id="s" x1="0" x2="1">
                  <stop offset="0%" stop-color="#2ecc71"/>
                  <stop offset="100%" stop-color="#0ea5a4"/>
                </linearGradient>
              </defs>
              <g transform="translate(130 130)">
                <g opacity=".95">
                  <ellipse rx="54" ry="88" fill="url(#p)" transform="rotate(0) translate(0,-34)"/>
                  <ellipse rx="54" ry="88" fill="url(#p)" transform="rotate(60) translate(0,-34)"/>
                  <ellipse rx="54" ry="88" fill="url(#p)" transform="rotate(120) translate(0,-34)"/>
                  <ellipse rx="54" ry="88" fill="url(#p)" transform="rotate(180) translate(0,-34)"/>
                  <ellipse rx="54" ry="88" fill="url(#p)" transform="rotate(240) translate(0,-34)"/>
                  <ellipse rx="54" ry="88" fill="url(#p)" transform="rotate(300) translate(0,-34)"/>
                </g>
                <circle r="34" fill="#ffd166"/>
                <circle r="18" fill="#ffb703" opacity=".9"/>
                <path d="M0 52 C 20 70, 10 110, 0 120 C -10 110, -20 70, 0 52 Z" fill="url(#s)" opacity=".95"/>
              </g>
            </svg>
          </div>

          <div class="pandas" aria-hidden="true">
            <div class="panda roamL" id="pandaL" style="--flip:-1;">
              <img src="photos/red-panda.png" alt="">
            </div>
            <div class="panda roamR" id="pandaR">
              <img src="photos/red-panda.png" alt="">
            </div>
          </div>

          <div class="winOverlay" id="winOverlay" aria-hidden="true">
            <div class="winBadge">
              <b>You win! üéâ</b>
              <span>Now go open the message ‚Üí</span>
            </div>
          </div>
        </div>

        <div class="howto" id="howto">
          <b>How to play:</b> tap/click petals as they fall. Collect <b id="goalInline2">14</b> to win.
          If a petal reaches the bottom, the red pandas eat it and your count goes down.
        </div>

        <div class="btnrow">
          <button class="primary" id="startBtn">Start</button>
          <button class="ghost" id="resetBtn">Reset</button>
        </div>

        <p class="footerNote">Tip: ‚ÄúMore petals‚Äù unlocks after you press Start.</p>
      </section>

      <section class="right">
        <div class="panelTitle">
          <h2>Message</h2>
        </div>

        <div class="envelopeWrap" id="envelopeWrap">
          <div class="envelope" id="envelope">
            <div class="env-body"></div>
            <div class="env-flap"></div>
            <div class="env-letter">You‚Äôve got mail üíå</div>
            <div class="env-front"></div>
            <div class="env-note">Win the game to unlock the button</div>
            <button class="unlockBtn" id="unlockBtn" type="button">Open üíå</button>
          </div>
        </div>

        <div class="inviteBox" id="inviteReveal" hidden aria-live="polite">
          <div class="inviteLine">
            <div class="dot"></div>
            <div><b>Date:</b> Saturday, Feb 14</div>
          </div>
          <div class="inviteLine">
            <div class="dot"></div>
            <div><b>Dress code:</b> whatever makes you feel pretty (or comfy‚Ä¶ or both)</div>
          </div>
          <div class="inviteLine">
            <div class="dot"></div>
            <div><b>Ready by:</b> ~12:30 PM. I can get you at home or from Polecats</div>
          </div>

          <div class="btnrow" style="margin-top:14px;">
            <button class="primary" id="yesBtn">Yes üå∑</button>
            <button class="warn" id="maybeBtn">Maybe üòå</button>
            <button class="ghost" id="reschedBtn">Resched üôè</button>
          </div>

          <div class="btnrow" style="margin-top:10px;">
            <a class="linkbtn ghost" id="spotifyBtn" href="#" target="_blank" rel="noopener">Spotify üéµ</a>
          </div>

          <div class="copiedPreview" id="copiedPreview" style="display:none;">
            <div class="copiedLabel">Copied text:</div>
            <div class="copiedBox" id="copiedTextBox"></div>
          </div>

          <p style="margin-top:12px; font-size:13px;">
            <b>Note:</b> If you say ‚ÄúYes‚Äù, I‚Äôll send the full details. If you say ‚ÄúMaybe/Resched‚Äù, we'll make it work!
          </p>
        </div>

        <div class="photos" id="photos" hidden>
          <div class="ph"><img src="photos/photo-1.jpg" alt="photo 1"></div>
          <div class="ph"><img src="photos/photo-2.jpg" alt="photo 2"></div>
          <div class="ph"><img src="photos/photo-3.jpg" alt="photo 3"></div>
        </div>
      </section>
    </div>
  </div>

  <script>
    const CONFIG = {
      name: "Ayl",
      goalPetals: 14,
      spotifyLink: "https://open.spotify.com/track/4nwjvcUjV7cexhwA40Bh5i?si=68523e38b36e42cd"
    };

    const PHOTO_URLS = [
      "photos/photo-1.jpg",
      "photos/photo-2.jpg",
      "photos/photo-3.jpg"
    ];

    const stage = document.getElementById("stage");
    const startBtn = document.getElementById("startBtn");
    const resetBtn = document.getElementById("resetBtn");
    const spawnBurst = document.getElementById("spawnBurst");

    const countEl = document.getElementById("count");
    const goalEl = document.getElementById("goal");
    const goalInline = document.getElementById("goalInline");
    const goalInline2 = document.getElementById("goalInline2");
    const barFill = document.getElementById("barFill");
    const nameEl = document.getElementById("name");

    const toast = document.getElementById("toast");
    const confetti = document.getElementById("confetti");

    const envelopeWrap = document.getElementById("envelopeWrap");
    const envelope = document.getElementById("envelope");
    const unlockBtn = document.getElementById("unlockBtn");
    const inviteReveal = document.getElementById("inviteReveal");

    const yesBtn = document.getElementById("yesBtn");
    const maybeBtn = document.getElementById("maybeBtn");
    const reschedBtn = document.getElementById("reschedBtn");
    const spotifyBtn = document.getElementById("spotifyBtn");

    const copiedPreview = document.getElementById("copiedPreview");
    const copiedTextBox = document.getElementById("copiedTextBox");

    const photos = document.getElementById("photos");
    const pandaL = document.getElementById("pandaL");
    const pandaR = document.getElementById("pandaR");

    const winOverlay = document.getElementById("winOverlay");

    let petalsCollected = 0;
    let raining = false;
    let rainTimer = null;

    let gameStarted = false;
    let gameWon = false;
    let envelopeUnlocked = false;

    function init(){
      nameEl.textContent = CONFIG.name;
      goalEl.textContent = CONFIG.goalPetals;
      goalInline.textContent = CONFIG.goalPetals;
      goalInline2.textContent = CONFIG.goalPetals;
      spotifyBtn.href = CONFIG.spotifyLink || "https://open.spotify.com/";

      // photos hidden until envelope unlocked
      const slots = photos.querySelectorAll("img");
      PHOTO_URLS.slice(0,3).forEach((url, idx) => {
        if (slots[idx]) slots[idx].src = url;
      });

      // More petals disabled until Start
      spawnBurst.disabled = true;

      // unlock button hidden until win
      unlockBtn.classList.remove("show");

      updateUI();
    }

    function updateUI(){
      countEl.textContent = petalsCollected;
      const pct = Math.min(100, (petalsCollected / CONFIG.goalPetals) * 100);
      barFill.style.width = pct + "%";

      if (!gameWon && petalsCollected >= CONFIG.goalPetals){
        onWin();
      }
    }

    function onWin(){
      gameWon = true;
      stopRain();
      freezeGame();

      winOverlay.classList.add("show");

      // enable envelope unlock button
      unlockBtn.classList.add("show");

      // subtle confetti for win
      burstConfetti();
    }

    function freezeGame(){
      // stop all motion and interactions in stage
      stage.classList.add("frozen");

      // remove remaining petals so nothing continues to fall visually
      stage.querySelectorAll(".petal").forEach(p => p.remove());

      // disable buttons that affect gameplay
      startBtn.disabled = true;
      spawnBurst.disabled = true;

      // stop panda roaming by pausing animations via .stage.frozen rule (covers them too)
      // also ensure no more timers
      if (rainTimer) clearInterval(rainTimer);
      rainTimer = null;
      raining = false;
    }

    function startRain(){
      if (raining || gameWon) return;
      raining = true;
      gameStarted = true;

      startBtn.textContent = "Petals incoming‚Ä¶";
      startBtn.disabled = true;

      // now enable More petals
      spawnBurst.disabled = false;

      spawnPetals(4);
      rainTimer = setInterval(() => spawnPetals(1), 1100);
    }

    function stopRain(){
      raining = false;
      startBtn.textContent = "Start";
      startBtn.disabled = false;
      if (rainTimer) clearInterval(rainTimer);
      rainTimer = null;
    }

    function resetAll(){
      // reset state
      if (rainTimer) clearInterval(rainTimer);
      rainTimer = null;

      petalsCollected = 0;
      raining = false;
      gameStarted = false;
      gameWon = false;
      envelopeUnlocked = false;

      // clear petals
      stage.querySelectorAll(".petal").forEach(p => p.remove());

      // unfreeze stage
      stage.classList.remove("frozen");

      // reset overlay
      winOverlay.classList.remove("show");

      // reset buttons
      startBtn.textContent = "Start";
      startBtn.disabled = false;

      spawnBurst.disabled = true;

      // reset pandas (resume animations)
      pandaL.classList.remove("chomp");
      pandaR.classList.remove("chomp");

      // reset envelope and unlock button
      envelope.classList.remove("open");
      unlockBtn.classList.remove("show");
      inviteReveal.hidden = true;
      photos.hidden = true;

      // reset copied preview
      copiedPreview.style.display = "none";
      copiedTextBox.textContent = "";

      updateUI();
    }

    function spawnPetals(n){
      if (gameWon) return;

      const rect = stage.getBoundingClientRect();
      const yEnd = stage.clientHeight + 90;

      for (let i=0;i<n;i++){
        const p = document.createElement("div");
        p.className = "petal";

        const startX = Math.random() * (rect.width - 30);
        const drift = (Math.random() * 120) - 60;
        const dur = 6.8 + Math.random()*3.2;
        const rot = (Math.random()*120 - 60).toFixed(1);

        p.style.left = startX + "px";
        p.style.top = "-40px";
        p.style.setProperty("--x0", "0px");
        p.style.setProperty("--x1", drift + "px");
        p.style.setProperty("--t", dur + "s");
        p.style.setProperty("--r", rot + "deg");
        p.style.setProperty("--yEnd", yEnd + "px");

        const hueShift = (Math.random()*10 - 5);
        p.style.filter = `saturate(1.05) hue-rotate(${hueShift}deg)`;

        let removed = false;

        const collect = (e) => {
          e.preventDefault();
          if (removed || gameWon) return;
          removed = true;

          petalsCollected += 1;

          p.animate([
            { transform: "scale(1) rotate(0deg)", opacity: 0.95 },
            { transform: "scale(1.35) rotate(25deg)", opacity: 0.0 }
          ], { duration: 220, easing: "ease-out" });

          setTimeout(()=>p.remove(), 180);
          updateUI();
        };

        p.addEventListener("click", collect, {passive:false});
        p.addEventListener("touchstart", collect, {passive:false});

        p.addEventListener("animationend", () => {
          if (removed || gameWon) return;
          removed = true;
          p.remove();

          const eater = Math.random() < 0.5 ? pandaL : pandaR;
          eater.classList.remove("chomp");
          void eater.offsetWidth;
          eater.classList.add("chomp");

          petalsCollected = Math.max(0, petalsCollected - 1);
          updateUI();
        });

        stage.appendChild(p);
      }
    }

    function unlockEnvelopeManually(){
      if (!gameWon || envelopeUnlocked) return;
      envelopeUnlocked = true;

      envelope.classList.add("open");

      setTimeout(() => {
        inviteReveal.hidden = false;
        photos.hidden = false; // photos only after envelope unlocked
      }, 720);
    }

    function showToast(text){
      toast.textContent = text;
      toast.classList.add("show");
      setTimeout(()=>toast.classList.remove("show"), 1200);
    }

    function buildReply(type){
      const base = {
        yes: `Yes üå∑ I‚Äôll be ready by ~10:30am on Feb 14.`,
        maybe: `Maybe üòå Feb 14 sounds nice ‚Äî what‚Äôs the plan?`,
        resched: `Can we reschedule? üôè Still want to see you though.`
      };
      return base[type] || base.yes;
    }

    function showCopiedPreview(text){
      copiedTextBox.textContent = text;
      copiedPreview.style.display = "block";
    }

    async function copyText(text){
      try{
        await navigator.clipboard.writeText(text);
        showToast("Copied ‚úÖ");
      }catch{
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        ta.remove();
        showToast("Copied ‚úÖ");
      }
    }

    function handleChoice(type){
      const t = buildReply(type);
      showCopiedPreview(t);
      copyText(t);
    }

    yesBtn.addEventListener("click", () => handleChoice("yes"));
    maybeBtn.addEventListener("click", () => handleChoice("maybe"));
    reschedBtn.addEventListener("click", () => handleChoice("resched"));

    function burstConfetti(){
      confetti.classList.add("show");
      confetti.innerHTML = "";
      const pieces = 80;
      for (let i=0;i<pieces;i++){
        const c = document.createElement("i");
        const x = Math.random() * 100;
        const d = 1.2 + Math.random()*1.6;
        const r = (Math.random()*180 - 90);
        c.style.left = x + "vw";
        c.style.setProperty("--ct", d + "s");
        c.style.setProperty("--cr", r + "deg");
        c.style.opacity = (0.65 + Math.random()*0.35).toFixed(2);
        confetti.appendChild(c);
        c.addEventListener("animationend", () => c.remove());
      }
      setTimeout(()=>confetti.classList.remove("show"), 2000);
    }

    startBtn.addEventListener("click", startRain);
    resetBtn.addEventListener("click", resetAll);

    spawnBurst.addEventListener("click", () => {
      if (!gameStarted || gameWon) return;
      spawnPetals(3);
    });

    unlockBtn.addEventListener("click", unlockEnvelopeManually);

    init();
  </script>
</body>
</html>